<!DOCTYPE html>
<html>

<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="viewport" content="width=device-width, user-scalable=no">
    <title>Capture Audio buffers</title>
    <style>
        code {
            white-space: pre;
            background-color: black;
            color: white;
        }
        html,
        body {
            width: 100%;
            height: 100%;
            margin: 0;
        }
        video {
            width: 100%;
            height: calc(100% - 2em);
            background: #000;
        }
        .button-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
        }

        .button-bar button {
            margin: 0;
            width: 50%;
            float: left;
            padding: 5px 0;
            border: 1px solid #111;
            background: #333;
            color: orange;
            font-weight: bold;
            text-transform: uppercase;
        }
    </style>
</head>

<body>
    <video id="vid" playsinline webkit-playsinline crossorigin="anonymous" autoplay muted controls>
        <source src="assets/talking_ellen.mp4" type="video/mp4">
    </video>

    <div class="button-bar">
        <button onclick="panToLeft();">Left</button>
        <button onclick="panToRight();">Right</button>
    </div>

    <script>
        // Fix iOS Audio Context by Blake Kus https://gist.github.com/kus/3f01d60569eeadefe3a1
        // MIT license
        (function () {
            window.AudioContext = window.AudioContext || window.webkitAudioContext;
            if (window.AudioContext) {
                window.audioContext = new window.AudioContext();
            }
            var fixAudioContext = function (e) {
                e.preventDefault();
                console.info('fixAudioContext ...')
                if (window.audioContext) {
                    // Create empty buffer
                    var buffer = window.audioContext.createBuffer(1, 1, 22050);
                    var source = window.audioContext.createBufferSource();
                    source.buffer = buffer;
                    // Connect to output (speakers)
                    source.connect(window.audioContext.destination);
                    // Play sound
                    if (source.start) {
                        source.start(0);
                    } else if (source.play) {
                        source.play(0);
                    } else if (source.noteOn) {
                        source.noteOn(0);
                    }
                }
                console.info('did fix ios bullshit!')
                // Remove events
                //document.removeEventListener('touchstart', fixAudioContext);
                document.removeEventListener('touchend', fixAudioContext);
                window.withAudioContext(audioContext);
            };
            // // iOS 6-8
            // document.addEventListener('touchstart', fixAudioContext);
            // iOS 9
            document.addEventListener('touchend', fixAudioContext);
        }) // DISABLED
        // })(); // ENABLED
    </script>
    <script src="main.js"></script>
</body>

</html>